#!groovy?

pipeline
{
agent any

options {
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '15', daysToKeepStr: '15', numToKeepStr: '15')
		}
tools {
  maven 'maven354'
  jdk 'jdk 1.8'
	  }
environment {
    Version="R21.2"
	Branch="RL21.2"
    CredentialID="tmach"
	TargetDir="base-release/Group/R21.2/Latest"
	}
	
	
stages 
{
	stage('Naming')
	{
		steps{
			script{
					V=VersionNumber projectStartDate: '', versionNumberString: '${BUILD_YEAR}.${BUILD_MONTH,XX}.${BUILD_DAY,XX}.${BUILDS_TODAY}', versionPrefix: "${Version}-", worstResultForIncrement: 'SUCCESS'
				    currentBuild.displayName = "${V}"
					echo = "${V}"
				
				  }
			}
	}
	stage('checkout')
	{
		steps{
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'Libs']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-Libs.git']]])

				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCDiaryApp']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-CSCDiaryApp.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCFsuApp']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-CSCFsuApp.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'IntegralAdminFramework']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-IntegralAdminFramework.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCGroupAsiaWeb/src/main/resources/com/bundle/common']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-bundle.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCGroupAsiaWeb/src/main/webapp/diary']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-diary.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCGroupAsiaWeb/src/main/webapp/fsu']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-CSCFsuweb.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCGroupAsiaWeb/src/main/webapp/smart']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-smart.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCGroupAsiaApp/src/main/java/com/csc/group']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-group-app.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCGroupAsiaApp/src/main/resources/com/csc/groupasia']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-group-spring-config.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCGroupAsiaApp/src/main/resources/group']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-group-screen-xml.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: ' CSCGroupAsiaWeb/src/main/webapp/group']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-group-web.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCGroupAsiaWeb/src/main/resources/com/bundle/group']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-group-bundle.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'ReportOut/SpoolingPrint/ENGLISH/pdfTemplate/common']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-common-report.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'CSCIntegralExtension']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-CSCIntegralExtension.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'integral-common-modules']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-common-modules.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'CheckoutOption', timeout: 90], [$class: 'CloneOption', depth: 0, noTags: false, reference: '', shallow: false, timeout: 90], [$class: 'SubmoduleOption', disableSubmodules: false, parentCredentials: true, recursiveSubmodules: true, reference: '', timeout: 90, trackingSubmodules: true]], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-Group.git']]])
				
				checkout([$class: 'GitSCM', branches: [[name: "$Branch"]], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'integral-common-documentation']], gitTool: 'Default', submoduleCfg: [], userRemoteConfigs: [[credentialsId: "$CredentialID", url: 'https://github.dxc.com/insurance/integral-common-documentation.git']]])
				
				}
	}
	stage('Build')
	{
		steps{
			script{
					sh 'mvn -P Group clean install -Dversion=${Version}'
					
					sh '''mv MBRDATA/target/*.war MBRDATA/target/MBRDATA.war

					cd CSCSmart400Batch/target/
					rm -f csc-smart400-batch.zip
					zip -r csc-smart400-batch.zip csc-smart400-batch

					cd ${WORKSPACE}
					rm -f report.zip
					zip -r report.zip ReportOut'''

			
				}
			}
	}
	// stage('S3-Upload')
	// {
	// 	steps{
				
	// 			s3Upload consoleLogLevel: 'INFO', dontWaitForConcurrentBuildCompletion: false, entries: [[bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'CSCGroupAsiaEAR/target/CSCGroupAsiaEAR/*.war', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false], [bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'MBRDATA/target/*.war', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false], [bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'CSCSmart400Batch/target/*.zip', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false], [bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'integral-common-modules/integral-batch-rs/target/integral-batch-rs.war', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false], [bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'report.zip', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false]], pluginFailureResultConstraint: 'FAILURE', profileName: 'integral-S3', userMetadata: []
				
	// 		}
	// }
	stage('Deploy')
	{
		steps{
			
			script{
					
					
					echo "deploying" 
					
				 }
			
			}
	}
	
}
	 
// post{
// 	always{
			
// 						emailext attachLog: true, body: '''

// Environment Details:

// Reg R21.2 integral-Group
// Repo: https://github.dxc.com/insurance/integral-Group.git/
// Branch: RL21.2
// Build No: $BUILD_NUMBER  
// Status:  $BUILD_STATUS! 

// S3 Bucket:  base-release/Group/R21.2/Latest


// Code Change Details:

// ${CHANGES}


// *** This is an automatically generated email, please do not reply ***        

// Regards,

// DevOps Team''', subject: '$PROJECT_NAME-#$BUILD_NUMBER-$BUILD_STATUS!', to: 'vdangi@dxc.com, svankayalap2@dxc.com'





// 	cleanWs()
			
			
// 		  }
// 	}

}
