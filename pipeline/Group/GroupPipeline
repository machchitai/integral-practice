#!groovy?

pipeline
{
agent any

options {
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '15', daysToKeepStr: '15', numToKeepStr: '15')
		}
tools {
  maven 'maven354'
  jdk 'jdk 1.8'
	  }
environment {
    Version="R21.2"
	Branch="RL21.2"
    CredentialID="tmach"
	TargetDir="base-release/Group/R21.2/Latest"
	}
	
	
stages 
{
	stage('Naming')
	{
		steps{
			script{
					V=VersionNumber projectStartDate: '', versionNumberString: '${BUILD_YEAR}.${BUILD_MONTH,XX}.${BUILD_DAY,XX}.${BUILDS_TODAY}', versionPrefix: "${Version}-", worstResultForIncrement: 'SUCCESS'
				    currentBuild.displayName = "${V}"
					echo = "${V}"
				
				  }
			}
	}
	
	stage('Build')
	{
		steps{
			script{
					sh 'mvn -P clean install -Dversion=${Version}'
					
					sh '''mv MBRDATA/target/*.war MBRDATA/target/MBRDATA.war

					cd CSCSmart400Batch/target/
					rm -f csc-smart400-batch.zip
					zip -r csc-smart400-batch.zip csc-smart400-batch

					cd ${WORKSPACE}
					rm -f report.zip
					zip -r report.zip ReportOut'''

			
				}
			}
	}
	stage('S3-Upload')
	{
		steps{
				
				s3Upload consoleLogLevel: 'INFO', dontWaitForConcurrentBuildCompletion: false, entries: [[bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'CSCGroupAsiaEAR/target/CSCGroupAsiaEAR/*.war', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false], [bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'MBRDATA/target/*.war', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false], [bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'CSCSmart400Batch/target/*.zip', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false], [bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'integral-common-modules/integral-batch-rs/target/integral-batch-rs.war', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false], [bucket: "${TargetDir}", excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: true, selectedRegion: 'ap-southeast-1', showDirectlyInBrowser: false, sourceFile: 'report.zip', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false]], pluginFailureResultConstraint: 'FAILURE', profileName: 'integral-S3', userMetadata: []
				
			}
	}
	stage('Deploy')
	{
		steps{
			
			script{
					
					
					echo "deploying" 
					
				 }
			
			}
	}
	
}
	 
post{
	always{
			
						emailext attachLog: true, body: '''

Environment Details:

Reg R21.2 integral-Group
Repo: https://github.dxc.com/insurance/integral-Group.git/
Branch: RL21.2
Build No: $BUILD_NUMBER  
Status:  $BUILD_STATUS! 

S3 Bucket:  base-release/Group/R21.2/Latest


Code Change Details:

${CHANGES}


*** This is an automatically generated email, please do not reply ***        

Regards,

DevOps Team''', subject: '$PROJECT_NAME-#$BUILD_NUMBER-$BUILD_STATUS!', to: 'taichi.mach@dxc.com'





	cleanWs()
			
			
		  }
	}

}
